# 图片上传功能测试说明

## 问题修复

已修复图片上传API的认证问题：
- 修改了 `/src/app/api/media/route.ts` 文件
- 现在从cookie中获取 `payload-token` 进行用户认证
- 与其他API路由保持一致的认证方式

## 测试步骤

### 1. 创建测试用户（如果需要）

如果没有可用的用户账户，可以运行以下命令创建默认管理员用户：

```bash
npx tsx scripts/reset-db.ts
```

这将创建默认管理员用户：
- 邮箱：admin@example.com
- 密码：admin123
- 用户名：admin

### 2. 登录测试

1. 打开浏览器访问：http://localhost:3001/login
2. 使用以下凭据登录：
   - 邮箱：admin@example.com
   - 密码：admin123

### 3. 图片上传测试

1. 登录成功后，访问：http://localhost:3001/test-image
2. 在富文本编辑器中：
   - 点击图片上传按钮
   - 选择一张图片文件
   - 确认图片能够成功上传并显示

### 4. 验证修复

- 图片上传应该不再返回401错误
- 上传的图片应该能够正确显示在编辑器中
- 保存后的内容应该包含正确的图片URL

## 技术细节

修复的核心问题：
- 原来的API直接使用 `request.headers` 进行认证
- 修改为从cookie中获取 `payload-token` 并构造 `Authorization` 头
- 这与项目中其他API路由的认证方式保持一致

## 注意事项

- 确保服务器正在运行（pnpm dev）
- 确保用户已正确登录
- 如果仍有问题，检查浏览器开发者工具的网络面板查看具体错误信息